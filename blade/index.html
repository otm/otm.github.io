<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  
    
    <meta name="go-import" content="otm.io/blade git https://gopkg.in/otm/blade">
    
  

  <title> Blade  &middot; otm.io </title>

  
  <link rel="stylesheet" href="https://otm.github.io/css/poole.css">
  <link rel="stylesheet" href="https://otm.github.io/css/syntax.css">
  <link rel="stylesheet" href="https://otm.github.io/css/hyde.css">
  <link rel="stylesheet" href="https://otm.github.io/css/prism.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.ico">

  
  <link href="" rel="alternate" type="application/rss+xml" title="otm.io" />

  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

  <link href='http://fonts.googleapis.com/css?family=Raleway:400,300' rel='stylesheet' type='text/css'>

  <script src="//ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js"></script>
  <script>
    WebFont.load({
      google: {
        families: ['Raleway']
      }
    });
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-65366004-1', 'auto');
    ga('send', 'pageview');
  </script>

</head>

<body>

<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1 class="brand"><a href="https://otm.github.io">otm.io</a></h1>
      <p class="lead">
       heeding the code 
      </p>
    </div>



    <ul class="sidebar-nav">
      <li><a href="https://otm.github.io/blog">Posts</a></li>
      
        <li><a href="/about/">About </a></li>
      
      <br/>
      
      <li>Code:</li>
        
          <li><a href="/blade/">Blade </a></li>
        
          <li><a href="/dynaconf/">Dynaconf </a></li>
        
          <li><a href="/sshauth/">sshauth </a></li>
        
      
    </ul>
      
      
      
      <a href="https://github.com/otm"><i class="fa fa-github-square"></i></a>&nbsp;&nbsp;
      <a href="https://plus.google.com/&#43;NilsLagerkvist"><i class="fa fa-google-plus"></i></a>

    <p class="footnote">powered by <a href="http://hugo.spf13.com">Hugo</a> <br/>
    &copy; 2015 Nils Lagerkvist. All rights reserved.</p>

  </div>
</div>


    <div class="content container">
  <div class="post">
    <h1 class="post-title">Blade
    
    <span class="badges">
    
    	<a href="https://godoc.org/github.com/otm/blade"><img class="badge" title="godoc" alt="godoc" src="https://godoc.org/github.com/otm/blade?status.png"></a>
    
    	<a href="https://github.com/otm/blade/fork"><img class="badge" title="fork me" alt="fork me" src="http://githubbadges.com/fork.svg?user=otm&amp;repo=blade&amp;style=default"></a>
    
    	<a href="https://github.com/otm/blade/releases/latest"><img class="badge" title="download" alt="download" src="https://img.shields.io/github/release/otm/blade.svg"></a>
    
    </span>
    
    </h1>
    

<h2 id="blade:5ec203a153377bbcca8d0af017818bcf">Blade</h2>

<p>Blade is a task runner designed to be an small and easy to use task runner and a replacement when using makefiles for not intended use.</p>

<h2 id="features:5ec203a153377bbcca8d0af017818bcf">Features</h2>

<ul>
<li>Define tasks in lua</li>
<li>Command line parameters are passed to the task</li>
<li>Automatic generated documentation</li>
<li>Create custom help messages for build targets</li>
<li>Create custom bash completion for build targets</li>
<li>Easily run shell commands</li>
<li>Built in file watcher</li>
<li>Easy install - one binary</li>
</ul>

<h2 id="install:5ec203a153377bbcca8d0af017818bcf">Install</h2>

<p>To build from source you need Go</p>

<pre><code>go get github.com/otm/blade
go install github.com/otm/blade
</code></pre>

<p>Pre built binaries can be downloaded at
<a href="https://github.com/otm/blade/releases/latest">https://github.com/otm/blade/releases/latest</a></p>

<h2 id="bash-completion:5ec203a153377bbcca8d0af017818bcf">Bash Completion</h2>

<p>The -generate-bash-conf option outputs the bash completion configuration to stdout. Either manually copy it or you can for instance use <code>tee</code>:</p>

<pre><code>blade -generate-bash-conf | sudo tee /etc/bash_completion.d/blade
</code></pre>

<p><strong>Note:</strong> The location of the bash completion configuration might differ depending on distribution and platform</p>

<p><strong>Note:</strong> zsh can also run bash completion commands.</p>

<h2 id="getting-started:5ec203a153377bbcca8d0af017818bcf">Getting Started</h2>

<p>Create a <code>Bladerunner</code> file. All targets will be executed with the current directory set to the directory containing the <code>Bladerunner</code> file. The blade command will search for the Bladerunner file in the file tree.</p>

<p>To create a <code>hello</code> target define a function on the target table. In the function you can execute arbitrary lua code.</p>

<pre><code class="language-lua">function target.hello()
  print(&quot;hello world&quot;)
end
</code></pre>

<p>To execute the target run</p>

<pre><code>blade hello
</code></pre>

<p>Lets expand the example by processing command line parameters.</p>

<pre><code class="language-lua">function target.hello(use)
  use = use or &quot;lua&quot;

  if use == &quot;shell&quot; then
    blade.sh([[echo &quot;hello world&quot;]])
  elseif use == &quot;lua&quot; then
    print(&quot;hello world&quot;)
  else
    print(&quot;unknown option: &quot; .. use)
  end
end
</code></pre>

<p>Run the following to test the new target</p>

<pre><code>blade hello
blade hello lua
blade hello shell
blade hello foo
</code></pre>

<h2 id="targets:5ec203a153377bbcca8d0af017818bcf">Targets</h2>

<p>Defining new blade targets is done by adding functions to the target table.</p>

<p><strong><em>Example:</em></strong></p>

<pre><code class="language-lua">function target.build()
  -- build target code
end
</code></pre>

<p><strong><em>Example: arguments</em></strong></p>

<pre><code class="language-lua">function target.install(devDeps)
  -- install target code
  -- example setting default values
  devDeps = devDeps or &quot;true&quot;
end
</code></pre>

<p><strong><em>Example: variable arguments</em></strong></p>

<pre><code class="language-lua">function target.install(...)
  -- If the ... notation is used arguments are assigned to the arg variable
  -- arg.n is special and returns the number of elements in arg
  -- To test: blade install -i --dev /var/log
  print(&quot;Number of inputs: &quot;, arg.n)
  for index, value in ipairs(arg) do
    print(index, &quot;=&quot;, value)
  end
end
</code></pre>

<h3 id="target-help:5ec203a153377bbcca8d0af017818bcf">target: help</h3>

<p>The only built in target is <code>help</code>. It will print an automatically generated help message. It is possible to target help messages, see <code>blade.help</code></p>

<pre><code class="language-lua">blade help
</code></pre>

<h3 id="target-blank:5ec203a153377bbcca8d0af017818bcf">target: <blank></h3>

<p>If not defining a target when running blade the <code>help</code> target will be executed. This can be overridden by setting <code>blade.default</code>.</p>

<p><strong><em>Example:</em></strong></p>

<pre><code class="language-lua">-- set the default target to `test`
blade.default = target.test

-- run a custom function for the default target
function blade.default()
  -- default target code
end
</code></pre>

<h2 id="setup-and-teardown:5ec203a153377bbcca8d0af017818bcf">Setup and teardown</h2>

<p>It is possible to run setup and teardown code that is run before and after the blade target. Returning false in the setup or teardown will abort the target execution.</p>

<h3 id="blade-setup:5ec203a153377bbcca8d0af017818bcf">blade.setup</h3>

<p><strong><em>Example:</em></strong></p>

<pre><code class="language-lua">function blade.setup()
  -- setup code
end
</code></pre>

<h3 id="teardown:5ec203a153377bbcca8d0af017818bcf">teardown</h3>

<p><strong><em>Example:</em></strong></p>

<pre><code class="language-lua">function blade.teardown()
  -- teardown code
end
</code></pre>

<h2 id="blade-api:5ec203a153377bbcca8d0af017818bcf">Blade API</h2>

<p>A small set of convince functions are provided, attached to a lua table called <code>blade</code>.</p>

<h3 id="blade-shell-shell-shell:5ec203a153377bbcca8d0af017818bcf">blade.shell(shell) =&gt; shell</h3>

<p>The default shell used is bash, setting the <code>blade.shell</code> variable overrides that.</p>

<p><strong><em>Example:</em></strong></p>

<pre><code class="language-lua">sh = blade.shell(&quot;zsh&quot;)
print(sh)
-- prints 'zsh'
</code></pre>

<h3 id="blade-sh-command-exitstatus-stdout-stderr:5ec203a153377bbcca8d0af017818bcf">blade.sh(command) =&gt; exitStatus, stdout, stderr</h3>

<p>Run arbitrary shell commands, executed in bash by default. If the command returns a non zero exit code the target execution will be aborted. The command is echoed to stdout, to suppress this use <code>blade._sh</code> instead.</p>

<p>Returns the exit status and the standard output from the command</p>

<p><strong><em>Example:</em></strong></p>

<pre><code class="language-lua">exitStatus, out = blade.sh(&quot;echo 'Hello World'&quot;)
-- outputs:
-- echo 'Hello World'
-- Hello World

exitStatus, out = blade._sh(&quot;echo 'Hello World'&quot;)
-- outputs:
-- Helo World
</code></pre>

<h3 id="blade-exec-command-exitstatus-stdout-stderr:5ec203a153377bbcca8d0af017818bcf">blade.exec(command) =&gt; exitStatus, stdout, stderr</h3>

<p><code>runner.exec</code>, does not abort target execution if the command returns a non zero exit code. <code>runner._exec</code> will suppress the command echo to stdout.</p>

<p><strong><em>Example:</em></strong></p>

<pre><code class="language-lua">blade.exec(&quot;false'&quot;)
print(&quot;command execution continues&quot;)

blade._exec(&quot;false&quot;)
print(&quot;commnd is not echoed to stdout, execution continues&quot;)

blade.sh(&quot;false&quot;)
print(&quot;This is not executed&quot;)
</code></pre>

<h3 id="blade-system-command-exitstatus-stdout-stderr:5ec203a153377bbcca8d0af017818bcf">blade.system(command) =&gt; exitStatus, stdout, stderr</h3>

<p>Like <code>blade.sh</code> but does not check anything, or echo anything.</p>

<p><strong><em>Example:</em></strong></p>

<pre><code class="language-lua">code, out, err = blade.system(&quot;echo 'Hello World' &amp;&amp; date -r&quot;)
print(&quot;code:&quot;, code)
print(&quot;stdout:&quot;, out)
print(&quot;stderr&quot;, err)
</code></pre>

<h3 id="blade-printstatus-message-status:5ec203a153377bbcca8d0af017818bcf">blade.printStatus(message, status)</h3>

<p>Prints a pretty printed status message to the terminal, normaly used for printing execution status.</p>

<p><strong><em>Example:</em></strong></p>

<pre><code class="language-lua">blade.printStatus(&quot;true&quot;, true)
blade.printStatus(&quot;false&quot;, false)
blade.printStatus(&quot;0&quot;, 0)
blade.printStatus(&quot;1&quot;, 1)
blade.printStatus(&quot;nil&quot;)
blade.printStatus(&quot;true (shell)&quot;, blade._exec(&quot;true&quot;))
blade.printStatus(&quot;false (shell)&quot;, blade._exec(&quot;false&quot;))
-- outputs
-- true                                                                  [ ok ]
-- false                                                                 [fail]
-- 0                                                                     [ ok ]
-- 1                                                                     [fail]
-- nil                                                                   [udef]
-- true (shell)                                                          [ ok ]
-- false (shell)                                                         [fail]
</code></pre>

<h3 id="blade-help-target-message:5ec203a153377bbcca8d0af017818bcf">blade.help(target, message)</h3>

<p>blade.help associates a message with a target.</p>

<p><strong><em>Example:</em></strong></p>

<pre><code class="language-lua">function target.build()
  -- build target code
end

blade.help(target.build, &quot;&lt;dev|prod&gt;&quot;)
</code></pre>

<h3 id="blade-compgen-target-optsorfunction:5ec203a153377bbcca8d0af017818bcf">blade.compgen(target, optsOrFunction)</h3>

<p>blade.compgen associates an opts string or a function that will be executed by blade if bash completion is set up. The function signature is:</p>

<p>function(compWords, compCWord)
* compWords: a table containing the arguments on the command line
* compCWord: a int pointing to the cursor position (zero indexed)</p>

<p><strong>Note on cursor position:</strong> (cursor denoted by &ldquo;|&rdquo;)
blade target | ==&gt; compWords = { target }, compCWord = 1<br />
blade target opt1| ==&gt; compWords = { target, opt1 }, compCWord = 1
balde target opt1 | ==&gt; compWords = { target, opt1 }, compCWord = 2</p>

<p><strong><em>Example:</em></strong></p>

<pre><code class="language-lua">function target.build()
  -- build target code
end

-- bind a static string
blade.compgen(target.build, &quot;dev prod&quot;)

-- bind a function
blade.compgen(target.build, function(compWords, compCWord)
if compCWord == 1 then
   return &quot;dev prod&quot;
 end
 return &quot;&quot;
end)
</code></pre>

<h2 id="plugins:5ec203a153377bbcca8d0af017818bcf">Plugins</h2>

<h3 id="blade-plugin-watch-callback-dir-recursive-filter-exclude:5ec203a153377bbcca8d0af017818bcf">blade.plugin.watch{callback, dir, recursive, filter, exclude}</h3>

<p>blade have a built-in simple file watcher.</p>

<ul>
<li><strong><em>callback - function(file, op):</em></strong> function for processing file events</li>
<li><strong><em>dir - string:</em></strong> the directory to watch</li>
<li><strong><em>recursive - bool:</em></strong> watch sub directories recursively</li>
<li><strong><em>filter - string:</em></strong> files matching regexp will be sent processed</li>
<li><strong><em>exclude - {string, &hellip;}:</em></strong> a table of strings of directories to exclude</li>
</ul>

<p><strong><em>Note:</em></strong> Several watch statements can be specified in one target</p>

<pre><code class="language-lua">function cmd.watch()
	blade.plugin.watch{callback=onFileEvent, dir=&quot;.&quot;}
end

function onFileEvent(file, op)
  print(&quot;File: &quot; .. file .. &quot;, Operation: &quot; .. op)
end
</code></pre>

<h2 id="lua:5ec203a153377bbcca8d0af017818bcf">Lua</h2>

<p>This section contains some Lua tips for new users</p>

<ul>
<li>Define strings: <code>&quot;str&quot;</code>, <code>'str'</code> or <code>[[str]]</code></li>
<li>Read environment variables: <code>os.getenv(&quot;HOME&quot;)</code></li>
<li>if-else: <code>if &lt;statement&gt; then &lt;code&gt; elseif &lt;statement&gt; then &lt;code&gt; else &lt;code&gt; end</code></li>
<li>named function variables: <code>fn{key=name, ...}</code></li>
<li>equivalent: <code>arg = {key=name, ...}; fn(arg)</code></li>
</ul>

  </div>
  </div>

  <script src="/js/prism.js"></script>
  </body>
</html>
